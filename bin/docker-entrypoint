#!/usr/bin/env bash
set -euo pipefail

rm -f /app/tmp/pids/server.pid

bundle check || bundle install

if [ "${1:-}" = "bundle" ] && [ "${2:-}" = "exec" ] && [ "${3:-}" = "rails" ] && [ "${4:-}" = "server" ]; then
  bundle exec rails db:prepare
fi

exec "$@"
