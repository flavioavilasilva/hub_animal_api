openapi: 3.0.3
info:
  title: Hub Animal API - Users
  version: 1.1.0
  description: API documentation for users CRUD endpoints.
servers:
  - url: /
paths:
  /auth/login:
    post:
      tags:
        - Auth
      summary: Login and return JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
  /users:
    get:
      tags:
        - Users
      summary: List users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
    post:
      tags:
        - Users
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  $ref: '#/components/schemas/UserCreateInput'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '422':
          description: Validation error
  /users/{id}:
    get:
      tags:
        - Users
      summary: Show user
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '404':
          description: User not found
    patch:
      tags:
        - Users
      summary: Update user
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user
              properties:
                user:
                  $ref: '#/components/schemas/UserUpdateInput'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
        '422':
          description: Validation error
    delete:
      tags:
        - Users
      summary: Delete user
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: User deleted
        '404':
          description: User not found
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Address:
      type: object
      additionalProperties: true
      properties:
        street:
          type: string
        number:
          type: string
        complement:
          type: string
        neighborhood:
          type: string
        city:
          type: string
        state:
          type: string
        zip_code:
          type: string
        country:
          type: string
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
          format: email
        user_type:
          type: string
          enum: [ong, visitor, admin]
        address:
          $ref: '#/components/schemas/Address'
        fantasy_name:
          type: string
          nullable: true
        site:
          type: string
          nullable: true
        cpf:
          type: string
          nullable: true
        cnpj:
          type: string
          nullable: true
        responsible:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UserCreateInput:
      type: object
      required:
        - name
        - email
        - user_type
        - address
        - password
        - password_confirmation
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        user_type:
          type: string
          enum: [ong, visitor, admin]
        address:
          $ref: '#/components/schemas/Address'
        fantasy_name:
          type: string
          nullable: true
        site:
          type: string
          nullable: true
        cpf:
          type: string
          nullable: true
        cnpj:
          type: string
          nullable: true
        responsible:
          type: string
          nullable: true
        password:
          type: string
          format: password
        password_confirmation:
          type: string
          format: password
      description: At least one of cpf or cnpj must be provided.
    UserUpdateInput:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        user_type:
          type: string
          enum: [ong, visitor, admin]
        address:
          $ref: '#/components/schemas/Address'
        fantasy_name:
          type: string
          nullable: true
        site:
          type: string
          nullable: true
        cpf:
          type: string
          nullable: true
        cnpj:
          type: string
          nullable: true
        responsible:
          type: string
          nullable: true
        password:
          type: string
          format: password
          nullable: true
        password_confirmation:
          type: string
          format: password
          nullable: true
      description: At least one of cpf or cnpj must be provided when both are absent.
    LoginInput:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
    LoginResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'
